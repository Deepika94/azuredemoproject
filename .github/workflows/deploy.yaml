name: Deploy application to AKS from ACR

on:
 push:
   workflow_dispatch:

jobs:
 deploy: 
   runs-on: ubuntu-latest

steps:
- name: checkout code
  uses: actions/checkout@v2

- name: Login to Azure CLI 
  uses: docker/login@v1
  with:
    username: ${{ secrets.DOCKER_REGISTRY_USERNAME }}
    password: ${{ secrets.DOCKER_REGISTRY_PASSWORD }}
    
- name: Pull the Images from Azure ACR
  run: docker pull deepikajag/aks-webapp:lts
    
- uses: azure/use-kubelogin@v1
  with:
    kubelogin-version: 'v0.0.24'

- name: Deploy application to AKS
  run: |
    kubectl apply -f /home/adm-deepika/azuredemoproject/Deployment.yaml

- name: Update kubernetes service 
  run: | 
    kubectl apply -f /home/adm-deepika/azuredemoproject/service.yaml
    
